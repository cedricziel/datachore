language: php

php:
    - 5.4

before_script:
    - composer install --no-interaction --dev
    - wget https://storage.googleapis.com/appengine-sdks/featured/google_appengine_1.9.10.zip -nv
    - unzip -q google_appengine_1.9.10.zip
    - patch -p0 < tests/patches/sdk-expose-remote-api-settings.patch

script:
    - bash -c './google_appengine/dev_appserver.py tests/ --php_executable_path=$HOME/.phpenv/versions/$(phpenv version-name)/bin/php-cgi --skip_sdk_update_check 1>out.log 2>err.log & echo $! > appengine.pid'
    - vendor/bin/phpunit tests/

after_script:
    - bash -c 'cat appengine.pid | xargs kill'
    - cat out.log
    - cat err.log
